<!DOCTYPE html>
{% load static %}
{% load widget_tweaks %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedido</title>
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" />






{% block content %}

{% if queryset %}
<header class="masthead">
    <div class="container d-flex h-100 align-items-center"> 
        <div class="mx-auto text-center">
<div class="bg-gray-100">
    <div class="card">
        <div class="card-header">
            <strong class="card-title">Pedido para el proveedor</strong>
        </div>
    </div>

    <div class="table-stats order-table ov-h">
        <table class="table" >
            <thead>
                <tr>
                    
                    <th style="color:white">Item</th>
                    <th style="color:white">Solicitado</th>
                    <th style="color:white">Disponible</th>

                </tr>
            </thead>
            <tbody>
                {% for pedido in queryset %}
                <tr>
                    
                    <td style="color:white">{{ pedido.item }}</td>
                    <td style="color:white">5</td>
                    <td style="color:white"><input type="Integer" class="input-cantidad" id="{{pedido.item}}" placeholder="0"></td>

                </tr>

                {% endfor %}
                
            </tbody>
            
        </table>
        
    </div>

</div>
<div class="text-center">
    <a href="{% url 'items:stock_recibido' %}" onclick="funcionCantidad()" class="btn btn-primary"> Enviar </a>
</div>
</div>
 </div>
    </div>
</header>
{% else %}
<h1>NO EXISTE EL PEDIDO >:( </h1>
{% endif %}
</header>
<footer class="footer bg-black small text-center text-white-50"><div class="container">Copyright &copy; Prisma Technology 2021</div></footer>
        <!-- Bootstrap core JS-->
        <script src="{% static 'js/jquery-3.5.1.min.js' %}"></script>
        <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
        <!-- Third party plugin JS-->
        <script src="{% static 'js/anime.min.js' %}"></script>
        <!-- Core theme JS-->
        <script src="{% static 'js/scripts.js' %}"></script>
</body>
</html>

<script>
    function funcionCantidad() {
        var csrftoken = getCookie('csrftoken');
        const inputsCantidades = document.getElementsByClassName('input-cantidad');
        for (input of inputsCantidades) {
            console.log(input.id)
            console.log(document.getElementById(input.id).value)
            $.ajax({
            type: "POST",
            url: "RecibirStock/",
            data:{
                csrfmiddlewaretoken : csrftoken, 
                item:input.id,
                cantidad:document.getElementById(input.id).value, 
            },
            dataType: "text",
            success: function(data) {
            console.log(data);
            },
            timeout: 1000,
            error: function( jqXHR, textStatus, errorThrown ) {

                if (jqXHR.status === 0) {

                    alert('Error al intentar Conectarse: Verifique su conexion a Internet.');

                } else if (jqXHR.status == 404) {

                    alert('La Pagina solicitada no fue encontrada [404]');

                } else if (jqXHR.status == 500) {

                    alert('Erro Interno [500]');

                } else if (textStatus === 'parsererror') {

                    alert('Error en el retorno de Datos. [parseJson]');

                } else if (textStatus === 'timeout') {

                    alert('Tiempo de Espera agotado');

                } else if (textStatus === 'abort') {
                    alert('Solicitud Abortada. [Ajax Request]');

                } else {
                    alert('Error desconocido: ' + jqXHR.responseText);

                }//end if 

            }//end error
        }); 
        }
    }
        function getCookie(name) {

            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            //RETORNANDO EL TOKEN
            return cookieValue;

        }//end function getCookie

    /*EJEMPLO AJAX HACIA DJANGO*/
  //token


</script>

{% endblock %}

